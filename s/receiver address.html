<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
    <meta name="keywords" content="前端团队,o2jteam前端团队,obj前端团队,北京世新天成科技有限公司,北京星辉光迅科技有限公司">
  
  
    <meta name="description" content="obj前端团队门户网站">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    利用ajax实现收货地址三级联动 |
    
    obj前端团队</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>

<body>
  <div class="o2jwrap">
    <main class="content">
      <div class="o2jbox">
        <section class="outer">
  <article id="page-" class="article article-type-page" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      利用ajax实现收货地址三级联动
    </h1>
  

      <!-- 目录内容 -->
      
      <!-- 目录内容结束 -->
    </header>
    

    

    <div class="article-entry" itemprop="articleBody">
      

      

      
      <p>我一直都在，而你却悄然离去。</p>
<h3 id="情景说明"><a href="#情景说明" class="headerlink" title="情景说明"></a>情景说明</h3><p>在我们日常购物（像淘宝，京东，美团等）或者注册某些网站的会员时，需要我们来填写地址，像省、市、县可以直接在下拉列表中选择，那么像这种“地址三级联动”怎么实现的呢？今天我们就通过ajax的技术，来模拟做一个地址的三级联动的功能。</p>
<a id="more"></a>
<p><img src="https://www.itsolotime.com/images/address/address-1.png" alt><br><img src="https://www.itsolotime.com/images/address/address-2.png" alt></p>
<h3 id="HTML结构"><a href="#HTML结构" class="headerlink" title="HTML结构"></a>HTML结构</h3><p>这里我们就简单的写一下结构，不进行样式（CSS）的渲染，后期可以进行样式的优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;收货地址三级联动&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;select id=&quot;selProvince&quot;&gt;</span><br><span class="line">  &lt;option value=&quot;&quot;&gt;--请选择省份--&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;select id=&quot;selCity&quot;&gt;</span><br><span class="line">  &lt;option value=&quot;&quot;&gt;--请选择城市--&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;select id=&quot;selCounty&quot;&gt;</span><br><span class="line">  &lt;option value=&quot;&quot;&gt;--请选择区/县--&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><em>词条：<a href="http://www.w3school.com.cn/tags/tag_option.asp" target="_blank" rel="noopener">option 标签</a></em></p>
<h3 id="项目分析"><a href="#项目分析" class="headerlink" title="项目分析"></a>项目分析</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p>1、当页面打开（加载）的时候，省级下拉列表数据需要进行加载。<br>2、当选择“某省”时，相对应的“市级”列表数据进行填充。<br>3、当选择“某市”时，相对应的“区县”列表数据进行填充。<br>4、当没有选择省级时，市县级无数据显示，同理，当没有选择市级时，区县级无数据显示。</p>
<h4 id="json数据分析"><a href="#json数据分析" class="headerlink" title="json数据分析"></a>json数据分析</h4><p>省级单位数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//直辖市数据</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;2&quot;,</span><br><span class="line">  &quot;province&quot;: &quot;北京市&quot;,</span><br><span class="line">  &quot;parent&quot;: &quot;1&quot;</span><br><span class="line">&#125;,</span><br><span class="line">//普通省级单位数据</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;36&quot;,</span><br><span class="line">  &quot;province&quot;: &quot;河北省&quot;,</span><br><span class="line">  &quot;parent&quot;: &quot;1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>市级单位数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//直辖市数据</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;2&quot;,</span><br><span class="line">  &quot;city&quot;: &quot;北京市&quot;,</span><br><span class="line">  &quot;parent&quot;: &quot;1&quot;</span><br><span class="line">&#125;,</span><br><span class="line">//省级下属市级单位数据</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;37&quot;,</span><br><span class="line">  &quot;city&quot;: &quot;石家庄市&quot;,</span><br><span class="line">  &quot;parent&quot;: &quot;36&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>区县级单位数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//直辖市下属区单位数据</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;3&quot;,</span><br><span class="line">  &quot;county&quot;: &quot;东城区&quot;,</span><br><span class="line">  &quot;parent&quot;: &quot;2&quot;</span><br><span class="line">&#125;,</span><br><span class="line">//普通市级下属区县单位数据</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;41&quot;,</span><br><span class="line">  &quot;county&quot;: &quot;新华区&quot;,</span><br><span class="line">  &quot;parent&quot;: &quot;37&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过以上的数据我们可以分析获得：<br>1、获取省级单位（含直辖市/自治区等）可以通过数据的“id”。<br>2、省级单位获取对应市级单位可以通过：省级单位的id==市级单位的parent<br>   <em>需要注意的是：直辖市和自治区在对应关系上和普通省份是不同的，应当用id = id</em><br>3、市级单位和区县级单位的关联关系（包含直辖市和自治区）符合市级单位的id == 区县级单位的parent</p>
<h4 id="bug分析"><a href="#bug分析" class="headerlink" title="bug分析"></a>bug分析</h4><p>1、可能会出现列表数据的紊乱，比如：市级列表中数据含有不同省对应的市级数据。</p>
<h4 id="接口文档"><a href="#接口文档" class="headerlink" title="接口文档"></a>接口文档</h4><p>1、获取省级单位的数据</p>
<ul>
<li>请求方式：GET</li>
<li>请求的url：’/getProvinces’（路由地址）</li>
<li>请求参数：</li>
<li>返回的数据格式：json</li>
</ul>
<p>2、获取市级单位的数据</p>
<ul>
<li>请求方式： POST</li>
<li>请求的url： ‘/getCities’（路由地址）</li>
<li>请求的参数: provinceId,</li>
<li>返回的数据格式: json</li>
</ul>
<p>3、获取区/县单位的数据</p>
<ul>
<li>请求方式： GET</li>
<li>请求的url： ‘/getCounties’（路由地址）</li>
<li>请求的参数: cityId,</li>
<li>返回的数据格式: json</li>
</ul>
<h3 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h3><h4 id="配置省级路由"><a href="#配置省级路由" class="headerlink" title="配置省级路由"></a>配置省级路由</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//引入json数据（中国省市县数据）china_area.json</span><br><span class="line">var chian_area = require(&apos;../china_area.json&apos;)</span><br><span class="line">//注册路由</span><br><span class="line">router.get(&apos;/getProvinces&apos; , funnction(req, res, next)&#123;</span><br><span class="line">	//创建一个变量来保存china_area中的省级的数据</span><br><span class="line">	var provinces = china_area.provinces;</span><br><span class="line">	//向客户端发送数据</span><br><span class="line">	res.send(provinces);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="配置市级路由"><a href="#配置市级路由" class="headerlink" title="配置市级路由"></a>配置市级路由</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.post(&apos;/getCities&apos; , funnction(req, res, next)&#123;</span><br><span class="line">	//创建一个变量来保存省级数据的id</span><br><span class="line">	var provinceId = req.body.provinceId;</span><br><span class="line">	//创建一个空数组，用来存放获取到的市级数据</span><br><span class="line">	var citiesArr = [];</span><br><span class="line">	//从china_area中获取市级数据并将其添加进空白数组</span><br><span class="line">	china_area.cities.forEach(funnction(city)&#123;</span><br><span class="line">		//当市级的parent值和省级单位的id相等 或者 市级单位的id和省级单位的id相等（主要针对直辖市&amp;自治区）</span><br><span class="line">		if(city.parent == provinceId || city.id == provinceId)&#123;</span><br><span class="line">			citiesArr.push(city);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	res.send(citiesArr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="配置区县级的路由"><a href="#配置区县级的路由" class="headerlink" title="配置区县级的路由"></a>配置区县级的路由</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">router.post(&apos;/getCounties&apos; , funnction(req, res, next)&#123;</span><br><span class="line">	//获取市级单位的Id</span><br><span class="line">	var cityId = req.query.cityId;</span><br><span class="line">	//创建一个空数组，用来存放获取到的区县级数据</span><br><span class="line">	var countiesArr = [];</span><br><span class="line">    china_area.counties.forEach(function (county) &#123;</span><br><span class="line">        // 获取对应的市级单位的数据</span><br><span class="line">        if(county.parent == cityId)&#123;</span><br><span class="line">            countiesArr.push(county);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.send(countiesArr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--引入jquery--&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;../js/jquery-1.11.1.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">  $(function () &#123;</span><br><span class="line">    var $selProvince = $(&apos;#selProvince&apos;);</span><br><span class="line">    var $selCity = $(&apos;#selCity&apos;);</span><br><span class="line">    var $selCounty = $(&apos;#selCounty&apos;);</span><br><span class="line">    // 发送请求获取所有的省级单位的数据</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">      type: &apos;GET&apos;,</span><br><span class="line">      url: &apos;/getProvinces&apos;,</span><br><span class="line">      success: function (provinces) &#123;</span><br><span class="line">        provinces.forEach(function (province, index) &#123;</span><br><span class="line">		  //格外要注意拼串时的“空格”</span><br><span class="line">          var provinceHtml = &apos;&lt;option value=&quot;&apos; + province.id +&apos;&quot;&gt;&apos; + province.province + &apos;&lt;/option&gt;&apos;;</span><br><span class="line">          $selProvince.append(provinceHtml);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $selProvince.change(function () &#123;</span><br><span class="line">      // 移除之前的option(第一个除外)，防止切换省级单位引起的市级单位数据紊乱</span><br><span class="line">      $selCity.children().not(&apos;:first&apos;).remove();</span><br><span class="line">      $selCounty.children().not(&apos;:first&apos;).remove();</span><br><span class="line"></span><br><span class="line">      // 当前省级单位的id</span><br><span class="line">      var provinceId = this.value;</span><br><span class="line">      if(provinceId == &apos;&apos;)&#123;</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">	  //市级单位</span><br><span class="line">      $.post(&apos;/getCities&apos;, &#123;provinceId: provinceId&#125;, function (cities) &#123;</span><br><span class="line">        cities.forEach(function (city) &#123;</span><br><span class="line">          var citiesHtml = &apos;&lt;option value=&quot;&apos; + city.id +&apos;&quot;&gt;&apos; + city.city + &apos;&lt;/option&gt;&apos;;</span><br><span class="line">          $selCity.append(citiesHtml);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $selCity.change(function () &#123;</span><br><span class="line">      $selCounty.children().not(&apos;:first&apos;).remove();</span><br><span class="line">	  //当前市级单位的id</span><br><span class="line">      var cityId = this.value;</span><br><span class="line">	  //区县级单位</span><br><span class="line">      $.getJSON(&apos;/getCounties&apos;, &#123;cityId: cityId&#125;, function (counties) &#123;</span><br><span class="line">        counties.forEach(function (county, index) &#123;</span><br><span class="line">          var countiesHtml = &apos;&lt;option value=&quot;&apos; + county.id +&apos;&quot;&gt;&apos; + county.county + &apos;&lt;/option&gt;&apos;;</span><br><span class="line">          $selCounty.append(countiesHtml);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h5 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h5><p><em>1、<a href="https://www.itsolotime.com/blog/demo/json/jquery-1.11.1.js" target="_blank" rel="noopener">jquery-1.11.1.js下载</a><br>2、<a href="https://www.itsolotime.com/blog/demo/json/china_area.json" target="_blank" rel="noopener">china_area.json下载</a></em></p>
<h2 id="联系小泊"><a href="#联系小泊" class="headerlink" title="联系小泊"></a>联系小泊</h2><p>email：<a href="mailto:643209899@qq.com" target="_blank" rel="noopener">643209899@qq.com</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://o2jteam.github.io/s/receiver address.html" data-id="cjx1lz3fp000y1onm3hj40kz3"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/">undefined</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/">undefined</a></li></ul>

    </footer>

  </div>

  
  

  

  

</article>

</section>
        <footer class="footer">
  
  <div class="outer">
    <!-- <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div> -->
    <ul class="list-inline">
      <li>&copy; 2019 o2jteam</li>
      <li>  <a href="https://o2jteam.github.io/" target="_blank">obj前端团队</a> 提供技术支持</li>
    </ul>
  </div>
</footer>

      </div>
    </main>
    <aside class="sidebar">
      <button class="navbar-toggle"></button>

<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="https://avatars2.githubusercontent.com/u/50328824?s=200&v=4" alt="obj前端团队"></a>
    <p class="o2jname">
      <a href="/">o2jteam</a>
    </p>
    <!-- <p>生活虽不易，未来亦可期。</p> -->
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">首页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">专题</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">设计</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
    <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>



  <script src="/js/search.js"></script>


<script src="/js/ocean.js"></script>

  </div>

</body>

</html>
